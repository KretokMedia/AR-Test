<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Place Screen - Scale & Rotate</title>
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

    <style>
      body { margin:0; overflow:hidden; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }

      /* Hidden until model is placed */
      #ui { display: none; }

      #ui {
        position: fixed;
        left: 0; right: 0; bottom: 0;
        padding: 12px 10px;
        display: flex;
        gap: 10px;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        pointer-events: none; /* let taps go through except on buttons */
      }

      .btn {
        pointer-events: auto;
        border: 0;
        padding: 10px 14px;
        border-radius: 999px;
        background: rgba(0,0,0,0.65);
        color: white;
        font-size: 14px;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
      }

      .btn.small { padding: 10px 16px; font-weight: 800; }

      #hint {
        position: fixed;
        left: 0; right: 0; bottom: 62px;
        text-align: center;
        color: white;
        font-size: 13px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.6);
        z-index: 9999;
        pointer-events: none;
        display: none; /* hidden until placed */
      }
    </style>
  </head>

  <body>
    <div id="hint">Tap anywhere to move. Use buttons to rotate/scale.</div>

    <div id="ui">
      <button id="rotLeft" class="btn">↺ Rotate</button>
      <button id="rotRight" class="btn">Rotate ↻</button>
      <button id="minusBtn" class="btn small">−</button>
      <button id="plusBtn" class="btn small">+</button>
    </div>

    <a-scene
      xr-mode-ui="XRMode: ar"
      renderer="antialias: false; precision: mediump; colorManagement: true"
      webxr="optionalFeatures: hit-test"
      ar-hit-test="target: #screen;"
      vr-mode-ui="enabled: false">

      <!-- Model. ar-hit-test will set visible=true when it places it the first time. -->
      <a-entity
        id="screen"
        gltf-model="screen.glb"
        visible="false"
        scale="0.08 0.08 0.08">
      </a-entity>

      <a-camera></a-camera>
    </a-scene>

    <script>
      const screenEl = document.querySelector("#screen");
      const ui = document.getElementById("ui");
      const hint = document.getElementById("hint");

      const plusBtn = document.getElementById("plusBtn");
      const minusBtn = document.getElementById("minusBtn");
      const rotLeft = document.getElementById("rotLeft");
      const rotRight = document.getElementById("rotRight");

      // Show UI only after the model is placed (visible=true)
      let placed = false;
      const obs = new MutationObserver(() => {
        const v = screenEl.getAttribute("visible");
        placed = (v === true || v === "true");
        ui.style.display = placed ? "flex" : "none";
        hint.style.display = placed ? "block" : "none";
      });
      obs.observe(screenEl, { attributes: true, attributeFilter: ["visible"] });

      const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

      // Scale: reliable buttons
      function scaleBy(factor) {
        const s = screenEl.object3D.scale.x;
        const next = clamp(s * factor, 0.02, 3.0);
        screenEl.object3D.scale.set(next, next, next);
      }
      plusBtn.addEventListener("click", () => scaleBy(1.15));
      minusBtn.addEventListener("click", () => scaleBy(0.87));

      // Rotate around its own Y axis (center) via buttons
      // Press-and-hold rotation feels better than single clicks
      let rotTimer = null;
      function startRotate(dir) {
        if (!placed) return;
        stopRotate();
        rotTimer = setInterval(() => {
          // Small increments = smooth
          screenEl.object3D.rotation.y += dir * 0.05; // radians per tick
        }, 16); // ~60fps
      }
      function stopRotate() {
        if (rotTimer) clearInterval(rotTimer);
        rotTimer = null;
      }

      // Pointer events work well on mobile + desktop
      rotLeft.addEventListener("pointerdown", (e) => { e.preventDefault(); startRotate(-1); });
      rotRight.addEventListener("pointerdown", (e) => { e.preventDefault(); startRotate(+1); });
      window.addEventListener("pointerup", stopRotate);
      window.addEventListener("pointercancel", stopRotate);

      // Optional: single-tap rotate step (in case you just click quickly)
      rotLeft.addEventListener("click", () => { if (placed) screenEl.object3D.rotation.y -= 0.25; });
      rotRight.addEventListener("click", () => { if (placed) screenEl.object3D.rotation.y += 0.25; });

      // IMPORTANT:
      // Movement is handled by ar-hit-test: tapping the scene moves the model.
      // The UI has pointer-events enabled only on the buttons, so normal taps still reach the AR scene.
    </script>
  </body>
</html>
